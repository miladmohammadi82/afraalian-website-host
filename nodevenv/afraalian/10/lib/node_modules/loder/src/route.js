import RoutePatten from 'route-pattern'
import { noop, isFunction } from './utils'
const loder = require('./index')

loder.route = (route, isHash = false, handler = noop) => {
  // 路由互斥，只有一个路由生效
  if (loder.get('_isRouteAlreadyExecuted')) return
  let matchResult

  if (isFunction(isHash)) {
    handler = isHash
    isHash = false
  }

  isHash = loder.configure.isHashRouter || isHash

  if (isHash && location.hash) {
    matchResult = RoutePatten.fromString(route).match(location.hash.slice(1))
  } else if (!isHash) {
    matchResult = RoutePatten.fromString(route).match(location.pathname)
  }
  if (matchResult && matchResult.pathParams) {
    loder.set('_isRouteAlreadyExecuted', true)
    handler(matchResult.pathParams)
  }
}

module.exports = loder
