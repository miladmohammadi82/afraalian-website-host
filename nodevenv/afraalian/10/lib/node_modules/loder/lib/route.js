'use strict';

var _routePattern = require('route-pattern');

var _routePattern2 = _interopRequireDefault(_routePattern);

var _utils = require('./utils');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var loder = require('./index');

loder.route = function (route) {
  var isHash = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;
  var handler = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : _utils.noop;

  // 路由互斥，只有一个路由生效
  if (loder.get('_isRouteAlreadyExecuted')) return;
  var matchResult = void 0;

  if ((0, _utils.isFunction)(isHash)) {
    handler = isHash;
    isHash = false;
  }

  isHash = loder.configure.isHashRouter || isHash;

  if (isHash && location.hash) {
    matchResult = _routePattern2.default.fromString(route).match(location.hash.slice(1));
  } else if (!isHash) {
    matchResult = _routePattern2.default.fromString(route).match(location.pathname);
  }
  if (matchResult && matchResult.pathParams) {
    loder.set('_isRouteAlreadyExecuted', true);
    handler(matchResult.pathParams);
  }
};

module.exports = loder;