<p align="center">
  <a href="http://loder-docs.scoii.com">
    <h1>Loder</h1>
  </a>
</p>
<p align="center">Extrema Slight Loder, blazing fast bootstrap your application.</p>

<p align="center">
  <img src="https://img.shields.io/badge/license-MIT-brightgreen.svg">
  <a href="https://travis-ci.org/yesvods/loder">
    <img alt="build status" src="https://api.travis-ci.org/yesvods/loder.svg?branch=master">
  </a>
  <a href="https://www.npmjs.com/package/loder">
    <img alt="npm" src="https://img.shields.io/npm/v/loder.svg?style=flat-square">
  </a>
</p>

---

* Dead Simple API
* å£°æ˜å¼ä¾èµ–ï¼Œæç®€çš„èµ„æºä»»åŠ¡ç®¡ç†
* æè‡´åŠ è½½ï¼Œæ‰€æœ‰èµ„æºéƒ½ä»¥æœ€é€‚åˆæ—¶åˆ»åŠ è½½
* è½»é‡ä½“ç§¯(1.4kb Gziped), æé€Ÿå¯åŠ¨åº”ç”¨
* å‡ ä¹æ— éœ€ä¿®æ”¹é€»è¾‘ï¼Œç®€å•å‡ æ­¥å³å¯åŠ é€Ÿåº”ç”¨è‡³æè‡´ï¼

## ğŸ”§ å¼•å…¥

```bash
$ npm install loder
```

```js
import loder from 'loder'
```

é™¤æ­¤ä¹‹å¤–ï¼Œ`loder`æä¾›`UMD`æ–¹å¼ï¼Œç›´æ¥é€šè¿‡`script`å¼•å…¥

## [LiveDemo](https://jsfiddle.net/dbg5gusu/1/)

## ğŸ“¦ æç®€ç¤ºä¾‹

åˆ©ç”¨æ‡’åŠ è½½è¯­æ³•`import`ï¼Œç®¡ç†èµ„æºä»»åŠ¡å˜å¾—å¼‚å¸¸ç®€å•

```js
loder.add('axios', () => import('axios'))

const axios = await loder.echo('axios')
```

è¯»åˆ°è¿™é‡Œï¼Œä½ å·²ç»å®Œå…¨äº†è§£`loder`çš„æ‰€æœ‰è¯­æ³•ï¼è®©èµ„æºä¸ä»»åŠ¡å˜å¾—å¼‚å¸¸ç®€å•ï¼Œ`loder`å°†è¿™ä¸¤è€…æŠ½è±¡ä¸ºä¸€ä¸ªæ¦‚å¿µï¼š`è¿‡ç¨‹`ã€‚

`è¿‡ç¨‹`æœ‰å¾ˆå¤šç§å½¢å¼ï¼Œé€šè¿‡ç»Ÿä¸€çš„æ–¹å¼ç®¡ç†`è¿‡ç¨‹`ï¼Œæ‰€æœ‰åŠ è½½å˜å¾—æå…¶ç®€å•ã€‚

## ğŸš… å®é™…åœºæ™¯

ä¸‹é¢ä»¥ä¸€ä¸ªå®é™…åœºæ™¯æ¥æ¼”ç¤ºï¼Œ`loder`å¦‚ä½•é€šè¿‡é«˜æ•ˆæ‰§è¡Œæ‰€æœ‰`è¿‡ç¨‹`å¹¶å¯åŠ¨åº”ç”¨ï¼š

* åº”ç”¨å¯åŠ¨

  * ä¾èµ–[ "é¦–å±æ•°æ®", "åº”ç”¨é‰´æƒ", "åº”ç”¨ Bundle åŠ è½½&æ‰§è¡Œ"]
  * å¯åŠ¨åº”ç”¨

* åº”ç”¨é‰´æƒ

  * ä¾èµ–[ "åŠ è½½é‰´æƒ SDK", "è·å¾—ç”¨æˆ· ID" ]
  * å‘èµ·é‰´æƒè¯·æ±‚

* é¦–å±æ•°æ®
  * ä¾èµ–[ "è¯·æ±‚å®¢æˆ·ç«¯ axios" ]
  * å‘èµ·å¤šä¸ªè¯·æ±‚

åº”ç”¨å¯åŠ¨å‰æœ‰ä¸€ç³»åˆ—`è¿‡ç¨‹`åŠ è½½ï¼š

![](assets/img/before.png)

#### å¯åŠ¨åº”ç”¨å‰é‰´æƒ

```js
// èµ„æºå£°æ˜
loder.add('authSDK', loder.loadScript('//sample.com/sdk.js'))
loder.add(
  'userId',
  () =>
    new Promise(resolve => {
      resolve('id')
    })
)

// ä»»åŠ¡å£°æ˜
loder.task(
  'auth',
  ['authSDK', 'userId'],
  () =>
    new Promise(resolve => {
      // do auth
      resolve('success')
    })
)
```

#### åŠ è½½é¦–å±æ•°æ®

```js
// åŠ è½½è¯·æ±‚å™¨
loder.add('axios', () => import('axios'))

// å£°æ˜é¦–å±æ•°æ®
loder.task(
  'fpData',
  ['axios'],
  () =>
    new Promise(resolve => {
      const axios = loder.get('axios')
      return axios('//sample.com/userData.json')
    })
)
```

#### å¯åŠ¨åº”ç”¨

```js
loder.add('createAppFn', () => import('./createAppFn'))

loder.task('bootstrap', ['auth', 'fpData'])

loder.run('bootstrap', async () => {
  const create = await loder.echo('createAppFn')
  create()
})
```

é€šè¿‡éå¸¸çš„ç®€å•å£°æ˜ï¼Œ`loder`ä¸ä»…ä»…å°†`PageLoaded`æ€§èƒ½æå‡è‡³æè‡´ï¼Œç”šè‡³å¯ä»¥åˆ©ç”¨é¦–å±æ•°æ®è¯·æ±‚æœŸé—´ï¼Œå»åŠ è½½åº”ç”¨æ‰€éœ€çš„èµ„æºè„šæœ¬ï¼Œä»¥åŠèŠ±è´¹å¤§é‡æ—¶é—´æ‰§è¡Œçš„`Bundle`ã€‚

![](assets/img/after.png)

## Loder vs SSR

| ç‰¹æ€§\æ–¹æ¡ˆ    | Loder                         | SSR                               |
| ------------ | ----------------------------- | --------------------------------- |
| Server æ”¯æŒ  | ä¸éœ€è¦                        | éœ€è¦ç»´æŠ¤é¢å¤– SSR æœåŠ¡å™¨           |
| Server å‹åŠ›  | ä½ï¼Œæ­£å¸¸ä½¿ç”¨ CDN æ–¹æ¡ˆ         | é«˜ï¼Œæ¯æ¬¡è¯·æ±‚éœ€ Server æ”¯æŒ        |
| Client       | æ— éœ€æ”¹åŠ¨ä¸šåŠ¡é€»è¾‘              | client-ssr ä¸¤å¥—ç‰ˆæœ¬               |
| é€šç”¨æ€§       | ä»»ä½•æ”¯æŒ JS æµè§ˆå™¨            | ç®€å•é¡µé¢ï¼Œå¦‚å®¢æˆ·ç«¯é‰´æƒæƒ…å†µä¸æ”¯æŒ  |
| é¦–å±æ¸²æŸ“æ—¶é—´ | å¿«ï¼Œæ— éœ€æµªè´¹æ¥å£è¯·æ±‚æ—¶é—´      | æå¿«ï¼Œä¸€æ¬¡è¯·æ±‚å¯è·å–é¦–å±å†…å®¹      |
| é¡µé¢ç©ºç™½æ—¶é—´ | å¿«é€Ÿå¯åŠ¨ï¼Œæå¤§å‡å°‘ç©ºç™½æ—¶ j é—´ | å¤§æ•°æ®æŸ¥è¯¢æ¥å£ï¼Œç©ºç™½æ—¶é—´è¾ƒé•¿      |
| å¯äº¤äº’æ—¶é•¿   | çŸ­ï¼Œè„šæœ¬åŠ è½½å®Œæˆå³å¯äº¤äº’      | ä¸­ï¼Œssr åä¾æ—§éœ€è¦å®Œå…¨åŠ è½½ bundle |

## API

Dead Simple APIï¼Œ`loder`åªä¿ç•™ä¸¤ä¸ªæ ¸å¿ƒ`API`: `loder()` å’Œ `loder.echo()`ï¼Œå…¶çµæ´»æ€§å¯ä»¥æ»¡è¶³å„ç§åŠ è½½åœºæ™¯ã€‚

### loder( loderName, pretasks, handler )

Alias `loder.register`ã€`loder.task`ã€`loder.add`

`loder`å°†`èµ„æº`å’Œ`ä»»åŠ¡`æŠ½è±¡æˆ`è¿‡ç¨‹`çš„æ¦‚å¿µï¼Œ`ä»»åŠ¡æ³¨å†Œ`ä»¥åŠ`èµ„æºæ·»åŠ `èƒ½ä»¥ç»Ÿä¸€`API`å»å£°æ˜ï¼

* name
  * ç±»å‹ï¼šString
  * `loder`åç§°ï¼ˆä»»åŠ¡åç§° | èµ„æºåç§°ï¼‰
* pretasks
  * ç±»å‹ï¼š[ String ]
  * ä¾èµ–çš„`loder`åç§° \* å¦‚æœæ²¡æœ‰ä¼ å…¥`handler`ï¼Œ`pretasks`è¿”å›çš„ç»“æœæ•°ç»„ä¼šä½œä¸ºæ­¤`loder`è¿”å›å€¼
* handler( loderResult )
  * ç±»å‹ï¼šFunction

```js
loder.add('axios', () => import('axios'))
loder.task('fetchData', ['axios'], () => {
  const axios = loder.get('axios')
  return axios('sample.com/result.json')
})

// Same as
loder('axios', () => import('axios'))
loder('fetchData', ['axios'], () => {
  const axios = loder.get('axios')
  return axios('sample.com/result.json')
})
```

### loder.echo( loderName, params, handler )

Alias `loder.run`ã€`loder.load`

åŒæ ·çš„`loder`ä¹ŸæŠŠ`è¿‡ç¨‹`çš„æ‰§è¡ŒæŠ½è±¡æˆæç®€çš„ APIã€‚åœ¨ä»£ç ç¼–å†™è¿‡ç¨‹ï¼Œæˆ‘ä»¬ä¹Ÿè®¸éœ€è¦åŒºåˆ†`ä»»åŠ¡`ä¸`èµ„æº`,`loder`æä¾›æ›´å‹å¥½çš„ API å»è§¦å‘æ‰§è¡Œã€‚å¤šæ¬¡æ‰§è¡ŒåŒä¸€`loder`è¿”å›ç›¸åŒç»“æœã€‚

* name
  * ç±»å‹ï¼šString | [ String ]
  * `loder`åç§°
* params
  * ç±»å‹ï¼šObject
  * æ‰§è¡Œ`loderName`æ—¶å€™ï¼Œç»™`handler`ä¼ é€’`params`å‚æ•°
  * æ‰§è¡Œå®Œç¬¬ä¸€æ¬¡å`loderName`ç»“æœä¼šè¢«ç¼“å­˜ï¼Œé‡å¤æ‰§è¡Œ`echo`ä¼ é€’ä¸åŒ`params`ç»“æœä¸ä¼šå˜åŒ–ã€‚éœ€è¦ä»¥æ–°`params`æ‰§è¡Œï¼Œå¯ä»¥ä½¿ç”¨`loder.reload`ã€‚
* handler( loderResult )
  * ç±»å‹ï¼šFunction
* è¿”å›
  * `loderName`æ‰§è¡Œçš„ç»“æœ
  * å¦‚æœ`handler`ä¼ å…¥ï¼Œåˆ™æ ¹æ®`handler`æ‰§è¡Œç»“æœè¿”å›

```js
// åŠ è½½èµ„æº
const axios = await loder.echo('axios')

// Same as
const axios = await loder.load('axios')

// æ‰§è¡Œä»»åŠ¡
loder.run('fetchData', response => {
  console.log('APIGet:', response.data)
})
```

### loder.reload( loderName, params, handler )

å‚æ•°åŒ`loder.echo`ï¼Œå¯ä»¥æ–°çš„å‚æ•°`params`é‡æ–°åŠ è½½`loder`ï¼ˆ`loder.echo`å¤šæ¬¡è°ƒç”¨ç»“æœä¸ä¼šå˜ï¼‰

é‡æ–°æ‰§è¡Œ`loderName`ï¼ŒåŒ…æ‹¬`pretask`ï¼Œé€‚ç”¨äºå¦‚ç½‘ç»œè¯·æ±‚é‡å‘ç­‰åœºæ™¯ã€‚

### loder.loadMatch( matchStr )

å¯ä»¥æ‰¹é‡åŠ è½½æ‰€åŒ¹é…çš„`loder`ï¼Œé€‚ç”¨äºé¦–å±æ¸²æŸ“å®Œä¹‹åï¼Œæ‡’åŠ è½½èµ„æºçš„å¼•å…¥ã€‚

* matchStr
  * ç±»å‹ï¼šString | RegExp
  * åŒ¹é…ç¬¦åˆçš„`loder`åç§°å¹¶åŠ è½½ä¹‹ï¼Œæ‡’åŠ è½½åœºæ™¯æœ‰å¥‡æ•ˆ

```js
loder('loder1', () => Promise.resolve('l1'))
loder('loder2', () => Promise.resolve('l2'))
loder('other3', () => Promise.resolve('o3'))

await loder.loadMatch('loder')

const l1 = loder.get('loder1') // l1
const l2 = loder.get('loder2') // l2
const o3 = loder.get('other3') // undefined
```

### loder.get( key )

åŒæ­¥ç‰ˆ`loder.echo`ã€‚

è·å–å€¼æ—¶å€™éœ€ç¡®ä¿å¯¹åº”`loder`å·²ç»æ‰§è¡Œå®Œæ¯•ï¼Œå¦åˆ™è¿”å›`undefined`

```js
// æ‰§è¡Œä»»åŠ¡
loder.run('fetchData', response => {
  // å¯ä»¥ç¡®å®šä¾èµ–çš„axioså·²ç»åŠ è½½å®Œæ¯•
  const axios = loder.get('axios') // Yeah, ä¸éœ€è¦awaitæ¥åŠ è½½
})
```

### loder.route( name, isHashRouter, handler )

å¯¹äº SPA åœºæ™¯ï¼Œå¤šå…¥å£åº”ç”¨éå¸¸å¸¸è§ï¼Œ`loder`æä¾›`route`æ–¹æ³•ã€‚æ™ºèƒ½è¯†åˆ«å½“å‰è·¯ç”±ï¼Œå¹¶æ³¨å†Œç›¸åº”`loder`ã€‚

* name
  * ç±»å‹ï¼šString
  * è·¯ç”±åŒ¹é…ç¬¦ï¼Œå¯ä»¥ä½¿ç”¨é€šé…æ¨¡å¼
* isHashRouter
  * ç±»å‹ï¼šBooleanï¼ˆé»˜è®¤ï¼šfalseï¼‰
  * æ˜¯å¦ä½¿ç”¨`hash`è·¯ç”±ï¼Œå¯ä»¥å•ç‹¬é…ç½®
  * ä¹Ÿå¯ä»¥é€šè¿‡è°ƒç”¨`loder.config({ isHashRouter: true })`ï¼Œæ”¹å˜é»˜è®¤è®¾ç½®
* handler(params)
  * ç±»å‹ï¼šFunction
  * å‚æ•°ä¸ºé€šé…å‚æ•°ï¼Œè‹¥éé€šé…å½¢å¼(æ¯”å¦‚ `/home`)åˆ™ä¸ºç©ºå¯¹è±¡

```js
// ä¸ºäº†ä¿æŒç²¾ç»†åŒ–ï¼Œloderæä¾›çš„routerç‰ˆæ‰æœ‰æ­¤æ–¹æ³•
import loder from 'loder/lib/route'

loder.route('/home', () => {
  loder.add('data', fetchHomeData())
})

loder.route('/about', () => {
  loder.add('data', fetchAboutData())
})

loder.route('*', () => {
  loder.add('data', fetchFallBackData())
})

// location.pathname === '/home'
const data = await loder.echo('data') // GET: homeData
```

é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨é€šé…æ–¹å¼ï¼Œå¤„ç†å™¨ä¼šå¸¦ä¸Šå¯¹åº”åŒ¹é…å‚æ•°ï¼š

```
loder.route('/user/:userId', (params) => {
  loder.add('data', fetchUserData({id: params.userId}))
})
// location.pathname === '/user/233'
const data = await loder.echo('data') // GET: 233 user data
```

### loder.loadScript( url, attributes )

å·¥å…·å‡½æ•°ï¼Œå¸®åŠ©å¿«é€Ÿæ·»åŠ å¤–éƒ¨`script`èµ„æºï¼Œè„šæœ¬`onload`è§¦å‘å`resolve`èµ„æºã€‚

```
const {lodeScript} = loder
const scriptUrl = `//cdnjs.cloudflare.com/ajax/libs/axios/${VERSION}/axios.js`
loder.add('axios', () => loadScript(scriptUrl).then(() => return window.axios))
```

### loder.set( key, value )

å·¥å…·å‡½æ•°ï¼Œè®¾ç½®å…¬ç”¨å€¼ï¼Œå¯è¦†ç›–`loder`çš„æ‰§è¡Œç»“æœã€‚

```js
loder.set('isFirstRendered', false)

// ...rendered
loder.set('isFirstRendered', true) // loder.get('isFirstRendered') => true

// å¯ä»¥è¦†ç›–loderæ‰§è¡Œçš„ç»“æœ
loder.set('axios', 'I am a string axios')
loder.get('axios') // 'I am a string axios'
```
